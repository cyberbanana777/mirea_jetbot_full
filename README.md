# Протокол взаимодействия Jetson с ESP32

## Возможные типы сообщений

В каждом сообщении есть полезная нагрузка и служебные символы ($;#).
- `$` - начало сообщения
- `;` - разделитель полезной нагрузки
- `#` - конец сообщения

### Jetson => ESP32 (сообщения-команды)

1. **Управление скоростиями платформы**
```
$1;V_linar_x;V_angular_z;#
```
где:
- `1` - тип сообщения
- `V_linar_x` - скорость платформы линейная по X (в м/с)
- `V_angular_z` - скорость платформы угловая по Z (в рад/с)

1. **Управление скоростиями каждого из моторов**
```
$2;left_wheel_speed;right_wheel_speed;#
```
где:
- `2` - тип сообщения
- `left_wheel_speed` - скорость левого колеса (в м/с)
- `right_wheel_speed` - скорость правого колеса (в м/с)

3. **Установка коэффициентов PID-регуляторов для управления скоростью моторов**
```
$3;Kp_L;Ki_L;Kd_L;Kp_R;Ki_R;Kd_R;#
```
где:
- `3` - тип сообщения
- `Kp_L` - коэффициент P регулятора левого колеса
- `Ki_L` - коэффициент I регулятора левого колеса
- `Kd_L` - коэффициент D регулятора левого колеса
- `Kp_R` - коэффициент P регулятора правого колеса
- `Ki_R` - коэффициент I регулятора правого колеса
- `Kd_R` - коэффициент D регулятора правого колеса
  
4. **Запись коэффициентов PID-регуляторов для управления скоростью моторов во Flash-память**
```
$4;Kp_L;Ki_L;Kd_L;Kp_R;Ki_R;Kd_R;#
```
где:
- `4` - тип сообщения
- `Kp_L` - коэффициент P регулятора левого колеса
- `Ki_L` - коэффициент I регулятора левого колеса
- `Kd_L` - коэффициент D регулятора левого колеса
- `Kp_R` - коэффициент P регулятора правого колеса
- `Ki_R` - коэффициент I регулятора правого колеса
- `Kd_R` - коэффициент D регулятора правого колеса
  
5. **Запрос коэффициентов PID-регуляторов**
```
$5;#
```
где:
- `5` - тип сообщения

### ESP32 => Jetson (сообщения-ответы)

1. **Получение одометрии и скоростей платформы и колёс**
```
$1;odom_x;odom_y;odom_theta;V_linar_x;V_angular_z;left_wheel_speed;right_wheel_speed;#
```
где:
- `1` - тип сообщения
- `odom_x` - координата X
- `odom_y` - координата Y
- `odom_theta` - угол поворота относительно стартового положения по оси Z (в радианах)
- `V_linar_x` - скорость платформы линейная по X (в м/с)
- `V_angular_z` - скорость платформы угловая по Z (в рад/с)
- `left_wheel_speed` - скорость левого колеса (в м/с)
- `right_wheel_speed` - скорость правого колеса (в м/с)

2. **Получение коэффициентов PID-регуляторов**
```
$2;Kp_L;Ki_L;Kd_L;Kp_R;Ki_R;Kd_R;#
```
где:
- `2` - тип сообщения
- `Kp_L` - коэффициент P регулятора левого колеса
- `Ki_L` - коэффициент I регулятора левого колеса 
- `Kd_L` - коэффициент D регулятора левого колеса
- `Kp_R` - коэффициент P регулятора правого колеса
- `Ki_R` - коэффициент I регулятора правого колеса
- `Kd_R` - коэффициент D регулятора правого колеса


## Сценарии использования

1. **Управление роботом:**
    Можно отправлять сообщения-команды типа 1 и 2 (в зависимости от того, чем Вы хотите управлять) с Jetson на ESP32. В ответ по таймеру будут приходить сообщения-ответы (одометрия и скорости платформы и колёс в ) типа 1 с ESP32 на Jetson.
2. **Изменение коэффициентов PID-регуляторов:**
    Если отправить сообщения-команды типа 3 с Jetson на ESP32, то коэффициенты регуляторов на ESP32 будут изменены. С ESP32 на Jetson нечего не будет отправлено (сообщения-ответа не будет отправляться).
3. **Изменение коэффициентов PID-регуляторов и запись в постоянную (Flash) память:**
    Если отправить сообщения-команды типа 4 с Jetson на ESP32, то коэффициенты регуляторов на ESP32 будут изменены. С ESP32 на Jetson нечего не будет отправлено (сообщения-ответа не будет отправляться).
4. **Получение коэффициентов PID-регуляторов:**
    Если отправить сообщение-команду типа 5 с Jetson на ESP32, то коэффициенты регуляторов на ESP32 будут отправлены в ответ в виде сообщения-ответа типа 2 с Jetson на ESP32.
    
